# System Design социальной сети для [курса по System Design](https://balun.courses/courses/system_design)

## 1. Общие сведения о проекте
Проектируемая система представляет собой социальную сеть для путешественников.
Результат проекта должен обеспечить достижение следующих целей:
- создание и вывод на рынок платформы для микроблогов и обмена фотографиями с уникальным фокусом на путешествия;
- создание конкуренции и последующее освоение ниши "социальной сети для обмена фотографиями", частично освобожденной в РФ после признания деятельности Instagram экстремистской;
- получение дохода - на втором этапе проекта планируется монетизации социальной сети за счет рекламы и интеграции сервисами/агрегаторами услуг в сфере путешествий.
Основными потребителями результатов проекта будут:
- жители стран СНГ, которые путешествуют или желают отправиться в путешествие;
- представители бизнеса в сфере путешествий.
Проект реализуется в следующих ограничениях:
- в данном документе рассматривается только core функциональность системы, актуальная для первого этапа проекта;
- функции регистрации нового пользователя, редактирования профиля пользователя, аутентификация, авторизация, а также хранение секретов не входят в границы задачи и в данном документе рассматриваться не будут;
- аналитическая отчетность, админ-панель для сотрудника соц.сети, реклама, интеграции сервисами/агрегаторами услуг в сфере путешествий и прочие функции развития не входят в границы задачи и в данном документе рассматриваться не будут;
- админ-панель для сотрудника соц.сети на первом этапе проекта не создается, наполнение справочников и редактирование изменяемых параметров системы должно выполняться через сотрудников отдела сопровождения.

## 2. Функциональные требования
1. Клиентская часть системы.
	1. Требуется разработать следующие клиентские части системы:
		- мобильное приложение для iOS;
		- мобильное приложение для Android;
		- web-приложение.
	2. Описанная в данном разделе функциональность должна быть доступна во всех вышеперечисленных клиентских приложениях.
2. Просмотр профиля и ленты пользователя.
	1. Пользователь может просматривать как свой профиль, так и профили других путешественников.
	2. Профиль пользователя состоит из двух разделов:
		1. Информация о пользователе. Содержит общие сведения о пользователе: Имя, Имя пользователя, Пол, Дата рождения, Город, Фото, О себе, Пользовательский статус.
		2. Лента постов пользователя в обратном хронологическом порядке. Глубина просмотра ленты/постов бесконечная.
	3. Пользователь может редактировать данные раздела "Информация о пользователе" в своем профиле.
3. Поиск пользователей.
	1. Для поиска пользователей должен быть реализован раздел "Путешественники".
	2. В разделе отображается список пользователей. Список отсортирован по убыванию количества подписчиков. Глубина просмотра списка путешественников бесконечная.
	3. По списку путешественников возможен поиск по полям:
		- Имя;
		- Имя пользователя.
4. Подписка на других путешественников. Управление подписками.
	1. Пользователь может подписаться на другого пользователя социальной сети, на которого еще не подписан.
	2. Пользователь может отписаться от другого пользователя, на которого ранее был подписан.
	3. Пользователь может просматривать список своих подписок.
	4. Пользователь может просматривать список своих подписчиков.
	5. Пользователь может просматривать список подписок других пользователей.
	6. Пользователь может просматривать список подписчиков других пользователей.
5. Просмотр ленты пользователя, основанной на подписках.
	1. В системе должен быть реализован раздел "Лента".
	2. В разделе "Лента" отображаются все посты пользователей, на которых подписан текущий пользователь. Список формируется в обратном хронологическом порядке. Глубина просмотра ленты/постов бесконечная.
6. Создание постов.
	1. Пользователь может создавать посты. 
	2. Пост содержит следующие данные:
		- Заголовок;
		- Текстовое описание;
		- Фотографии (не более 10);
		- Место путешествия.
	3. При создании поста место путешествия можно заполнить двумя способами:
		- выбрать из справочника географических объектов и достопримечательностей вручную (управление справочником осуществляется сотрудниками соц.сети); возможен поиск места в справочнике по названию;
		- определить ближайшее место на основании текущего местоположения устройства пользователя (если пользователь предоставил доступ к геолокации).
	4. Свои ранее опубликованные посты пользователь может отредактировать. Редактирование доступно только в течение 24 часов после создания поста.
	5. Свои ранее опубликованные посты пользователь может удалить.
7. Оценка постов других путешественников.
	1. Пользователь может поставить реакцию под постом другого пользователя.
	2. В качестве реакции пользователь выбирает эмодзи (только одну из предустановленного набора, включающего 5 эмодзи);
	3. Ранее поставленную реакцию можно удалить.
8. Комментирование постов.
	1. При просмотре поста пользователь может оставить комментарий.
	2. Пользователь может оставить комментарий:
		- под постом;
		- под другим комментарием (ответ на комментарий).
	3. Комментарий содержит только текст.	
	4. Ранее оставленный комментарий можно отредактировать. Редактирование доступно только в течение 15 минут после создания комментария.
	5. Ранее оставленный комментарий можно удалить.
9. Поиск популярных мест для путешествий
	1. Для поиска популярных мест для путешествий должен быть реализован раздел "Места путешествий".
	2. В разделе отображается список мест путешествий. Список мест отсортирован по убыванию количества упоминаний в постах пользователей.
	3. Список мест путешествий можно фильтровать:
		- по стране;
		- по категории.
	4. При клике/тапе по конкретному месту из списка открывается карточка места.
	5. Карточка места состоит из трех разделов:
		1. Информация о месте путешествия. Содержит данные: Наименование, Страна, Категория.
		2. Карта, на которой отображается точка, определенная по координатам места;
		3. Список постов, в которых упоминается это место. Список формируется в обратном хронологическом порядке. Глубина просмотра ленты/постов бесконечная.

## 3. Нефункциональные требования
1. Сезонность.
	- летом, а также в периоды новогодних и майских праздников посещаемость увеличивается на 100%.
2. Количество пользователей:
	- 10 000 000 DAU - низкий сезон;
	- 20 000 000 DAU - высокий сезон.
 	- ожидается, что через 1 год после запуска соц.сети будет создано 100 000 000 аккаунтов/профилей пользователей.
3. География использования:
	- страны СНГ.
4. Срок хранения данных: 
	- бессрочно.
5. Архивирование данных:
	- не требуется.
6. Активности пользователей:
	- каждый пользователь в среднем редактирует свой профиль путешественника 6 раз в год;
	- каждый пользователь просматривает в среднем 1 профиль путешественника в день;
	- средняя глубина просмотра ленты постов в профиле пользователя - 30 постов;
	- каждый пользователь просматривает список путешественников в среднем 1 раз в день;
	- средняя глубина просмотра списка пользователей - 12 пользователей;
	- каждый пользователь в среднем 0.15 раз в день выполняет поиск в списке пользователей;
	- средняя глубина просмотра списка пользователей при поиске - 15 пользователей;
	- каждый пользователь в среднем подписывается на 0,5 пользователя в день;
	- каждый пользователь отписывается от пользователя в среднем 0,2 раз в день;
	- каждый пользователь просматривает список своих подписок 0,2 раза в день;
	- средняя глубина просмотра списка подписок - 40 пользователей;
	- каждый пользователь просматривает список своих подписчиков 1 раз в день;
	- средняя глубина просмотра списка подписчиков - 50 пользователей;
 	- в среднем у каждого пользователя 60 подписок;
  	- в среднем у каждого пользователя 70 подписчиков;
	- каждый пользователь просматривает ленту постов, основанную на подписках, в среднем 2 раза в день;
	- средняя глубина просмотра ленты постов, основанной на подписках, 50 постов;
	- каждый пользователь создает в среднем 0,13 поста в день;
	- каждый пользователь изменяет пост в среднем 6 раз в год;
	- каждый пользователь удаляет пост в среднем 2 раз в год;
	- в среднем каждый пост содержит 3 фотографии;
	- средний размер фотографии, которую пользователь выбирает на устройстве, для загрузки в систему - 4 MB;
	- средний размер фотографии, сохраняемой в систему - 300 KB;
	- средний размер текстового описания каждого поста - 460 символов;
	- каждый пользователь просматривает в среднем 5 постов (подробная информация) в день;	
	- каждый пользователь ставит реакцию под постом в среднем 4 раз в день;
	- каждый пользователь удаляет реакцию в среднем 0.1 раз в день;
	- каждый пользователь в среднем просматривает список реакций на пост 3 раза в день;
	- средняя глубина просмотра списка реакций на пост - 30 реакций;
	- каждый пользователь пишет комментарий 2 раза в день;
	- средний размер комментария - 105 символов;
	- каждый пользователь просматривает в среднем комментарии под 5 постами в день.
	- средняя глубина просмотра комментариев под постами - 15 комментариев;
	- каждый пользователь изменяет комментарий в среднем 10 раз в год;
	- каждый пользователь удаляет комментарий в среднем 6 раз в год;
	- каждый пользователь просматривает список мест для путешествий в среднем 0,15 раза в день;
	- средняя глубина просмотра списка мест - 30 мест для путешествий;
	- каждый пользователь в среднем 0,1 раз в день выполняет поиск в списке мест для путешествий;
	- каждый пользователь просматривает в среднем 0,1 карточку места для путешествия в день;
	- средняя глубина просмотра ленты постов в карточке места для путешествия - 50 постов. 	
7. Лимиты и ограничения:
	- У пользователя может быть только 1 профиль;
	- В профиле пользователя может быть указано не более 1 фотографии (аватар);
	- У пользователя может быть не более 5 000 подписок;
	- Пользователь может подписаться не более 200 раз в сутки.
	- Пользователь может отписаться не более 400 раз в сутки.
	- У пользователя может быть не более 100 000 000 подписчиков;
	- Пользователь может создавать не более 20 постов в день;
	- Пост может содержать не более 10 фотографий;
	- Максимальный размер фотографии, которую пользователь может выбрать на устройстве для загрузки в систему: 10 MB;
	- Максимальный размер фотографии для сохранения в системе (после сжатия): 500 KB.
	- Пользователь может поставить только 1 реакцию под постом;
	- Пользователь может оставить не более 300 реакций в сутки;
	- Пользователь может оставить не более 100 комментариев в сутки.
	- Загрузка ленты постов - по 20 постов в режиме бесконечной ленты;
	- Загрузка списка реакций - по 50 реакций в режиме бесконечной ленты;
	- Загрузка комментариев - по 20 комментариев в режиме бесконечной ленты;
	- Загрузка списка пользователей (путешественников/подписок/подписчиков) - по 20 пользователей в режиме бесконечной ленты;
	- Загрузка списка мест для путешествий - по 20 мест для путешествий в режиме бесконечной ленты.
8. Временные ограничения:
	- получение профиля пользователя - 1 сек.;
	- получение ленты постов пользователя: 1,5 сек.;
	- получение ленты по подпискам: 2 сек.;
	- получение списка пользователей: 2 сек;
	- поиск пользователя: 2 сек.;
	- подписка/отписка: 1 сек.;
	- создание/редактирование поста: 2 сек.;
	- удаление поста: 1 сек.;
	- создание/удаление реакции: 1 сек.;
	- создание/редактирование комментария: 1 сек;
	- удаление комментария: 1 сек.;
	- получение списка мест для путешествий 2 секунды;
	- поиск места для путешествия: 2 сек.;
	- получение карточки места путешествия: 1 сек.;
	- получение ленты постов по месту путешествия: 2 сек.
9. Целевая доступность: 
	- 99,99% (не более 52,56 минут простоя в год).
10. Время восстановления при аварии (RTO): 
	- 2 часа.
11. Срок утраты данных при аварии (RPO): 
	- 30 минут.
## 4. Оценка нагрузки
### 4.1. RPS
#### 4.1.1. Пользователи

| Операция                            | Тип       | RPS в низкий сезон                       | RPS в высокий сезон |
| ----------------------------------- | --------- | ---------------------------------------- | ------------------- |
| Изменение информации о пользователе | Write     | 10 000 000 * 0,016 / 86 400 ≈ 10 RPS     | 20 RPS              |
| Получение информации о пользователе | Read      | 10 000 000 * 1 / 86 400 ≈ 120 RPS        | 240 RPS             |
| Получение списка пользователей      | Read      | 10 000 000 * 1 / 86 400 ≈ 120 RPS        | 240 RPS             |
| Поиск пользователей                 | Read      | 10 000 000 * 0,15 / 86 400 ≈ 20 RPS      | 40 RPS              |
| Получение списка подписок           | Read      | 10 000 000 \* 0,2 \* 2 / 86 400 ≈ 50 RPS | 100 RPS             |
| Получение списка подписчиков        | Read      | 10 000 000 \* 1 \* 3 / 86 400 ≈ 350 RPS  | 700 RPS             |
| **ИТОГО Write**                     | **Write** | **10 RPS**                               | **20 RPS**          |
| **ИТОГО Read**                      | **Read**  | **660 RPS**                              | **1320 RPS**        |
#### 4.1.2. Подписки / отписки
| Операция                 | Тип       | RPS в низкий сезон                 | RPS в высокий сезон |
| ------------------------ | --------- | ---------------------------------- | ------------------- |
| Подписка на пользователя | Write     | 10 000 000 * 0,5 / 86 400 ≈ 60 RPS | 120 RPS             |
| Отписка от пользователя  | Write     | 10 000 000 * 0,2 / 86 400 ≈ 30 RPS | 60 RPS              |
| **ИТОГО Write**          | **Write** | **90 RPS**                         | **180 RPS**         |
#### 4.1.3. Посты

| Операция                                                     | Тип       | RPS в низкий сезон                       | RPS в высокий сезон |
| ------------------------------------------------------------ | --------- | ---------------------------------------- | ------------------- |
| Создание поста                                               | Write     | 10 000 000 * 0,13 / 86 400 ≈ 20 RPS      | 40 RPS              |
| Изменение поста                                              | Write     | 10 000 000 * 0,016 / 86 400 ≈ 5 RPS      | 10 RPS              |
| Удаление поста                                               | Write     | 10 000 000 * 0,005 / 86 400 ≈ 5 RPS      | 10 RPS              |
| Получение поста                                              | Read      | 10 000 000 * 5 / 86 400 ≈ 580 RPS        | 1160 RPS            |
| Получение ленты постов пользователя                          | Read      | 10 000 000 \* 1 \* 2 / 86 400 ≈ 240 RPS  | 480 RPS             |
| Получение ленты постов, основанную на подписках пользователя | Read      | 10 000 000 \* 2 \* 3 / 86 400 ≈ 700 RPS  | 1400 RPS            |
| Получение ленты постов в карточке места путешествия          | Read      | 10 000 000 \* 0,1 \* 3 / 86 400 ≈ 40 RPS | 80 RPS              |
| **ИТОГО Write**                                              | **Write** | **30 RPS**                               | **60 RPS**          |
| **ИТОГО Read**                                               | **Read**  | **1560 RPS**                             | **3120 RPS**        |
#### 4.1.4. Реакции

| Операция                 | Тип       | RPS в низкий сезон                 | RPS в высокий сезон |
| ------------------------ | --------- | ---------------------------------- | ------------------- |
| Создание реакции         | Write     | 10 000 000 * 4 / 86 400 ≈ 470 RPS  | 940 RPS             |
| Удаление реакции         | Write     | 10 000 000 * 0,1 / 86 400 ≈ 20 RPS | 40 RPS              |
| Получение списка реакций | Read      | 10 000 000 * 3 / 86 400 ≈ 580 RPS  | 1160 RPS            |
| **ИТОГО Write**          | **Write** | **490 RPS**                        | **980 RPS**         |
| **ИТОГО Read**           | **Read**  | **580 RPS**                        | **1160 RPS**        |
#### 4.1.5. Комментарии

| Операция                      | Тип       | RPS в низкий сезон                  | RPS в высокий сезон |
| ----------------------------- | --------- | ----------------------------------- | ------------------- |
| Создание комментария          | Write     | 10 000 000 * 2 / 86 400 ≈ 240 RPS   | 480 RPS             |
| Изменение комментария         | Write     | 10 000 000 * 0,027 / 86 400 ≈ 5 RPS | 10 RPS              |
| Удаление комментария          | Write     | 10 000 000 * 0,016 / 86 400 ≈ 5 RPS | 10 RPS              |
| Получение списка комментариев | Read      | 10 000 000 * 5 / 86 400 ≈ 580 RPS   | 1160 RPS            |
| **ИТОГО Write**               | **Write** | **250 RPS**                         | **500 RPS**         |
| **ИТОГО Read**                | **Read**  | **580 RPS**                         | **1160 RPS**        |
#### 4.1.6. Места путешествий

| Операция                          | Тип      | RPS в низкий сезон                        | RPS в высокий сезон |
| --------------------------------- | -------- | ----------------------------------------- | ------------------- |
| Получение списка мест путешествий | Read     | 10 000 000 \* 0,15 \* 2 / 86 400 ≈ 40 RPS | 80 RPS              |
| Поиск мест путешествий            | Read     | 10 000 000 * 0,1 / 86 400 ≈ 20 RPS        | 40 RPS              |
| Получение места путешествия       | Read     | 10 000 000 * 0,1 / 86 400 ≈ 20 RPS        | 40 RPS              |
| **ИТОГО Read**                    | **Read** | **80 RPS**                                | **160 RPS**         |
## 4.2. Трафик
#### 4.2.1. Пользователи
User Profile JSON:
```JSON
{
  "userId": "123e4567-e89b-12d3-a456-426655440000",         // ~ 49 B
  "name": "John McClane",                                   // ~ 23 B 
  "username": "die_hard_007",                               // ~ 27 B 
  "birthday": "14.08.1979",                                 // ~ 25 B 
  "sex": "M",                                               // ~ 11 B 
  "city": "Барнаул",                                        // ~ 25 B 
  "userStatus": "В Турции! Кому пахлавы привезти?)",        // ~ 76 B 
  "about": "Фыва, пролдж и тот еще йцукен",                 // ~ 64 B 
  "photo": "https://cdn-domain.com/avatars/file-name.jpg",  // ~ 56 B 
  "isOnline": true,                                         // ~ 17 B 
  "lastSeen": "2017-07-21T17:32:28Z",                       // ~ 35 B 
  "isSubscribed": true,                                     // ~ 21 B 
  "subscriptionsCount": 114,                                // ~ 26 B 
  "followersCount": 162                                     // ~ 22 B 
}                                                           // ИТОГО ~ 477 B ~ 0,5 KB
```

|                           | Трафик в низкий сезон                                                    | Трафик в высокий сезон |
| ------------------------- | ------------------------------------------------------------------------ | ---------------------- |
| **JSON Traffic (Write)**  | 10 RPS * 0,5 KB ≈ 5 KB/Sec                                               | 10 KB/Sec              |
| **Media Traffic (Write)** | 10 RPS * 4 MB ≈ 40 MB/Sec                                                | 80 MB/Sec              |
| **JSON Traffic (Read)**   | 120 RPS \* 0,5 KB + 540 RPS * 0,5 KB \* 20 (размер батча) ≈ 5,46 MB/Sec  | 10,92 MB/Sec           |
| **Media Traffic (Read)**  | 120 RPS \* 0,3 MB + 540 RPS * 0,3 MB \* 20 (размер батча) ≈ 3 276 MB/Sec | 6 552 MB/Sec           |
#### 4.2.2. Подписки / отписки
Subscription JSON:
```JSON
{
  "leaderId"  : "123e4567-e89b-12d3-a456-426655440000",      // ~ 49 B
  "followerId": "123e4567-e89b-12d3-a456-426655440300"       // ~ 49 B
}                                                            // ИТОГО ~ 98 B ~ 0,01 KB
```

|                          | Трафик в низкий сезон         | Трафик в высокий сезон |
| ------------------------ | ----------------------------- | ---------------------- |
| **JSON Traffic (Write)** | 90 RPS * 0,01 KB ≈ 0,9 KB/Sec | 1,8 KB/Sec             |
#### 4.2.3. Посты
Post JSON:
```JSON
{
  "postId": "123e4567-e89b-12d3-a456-426655440001",          // ~ 49 B
  "userId": "123e4567-e89b-12d3-a456-426655440000",          // ~ 49 B
  "title": "Пять причин, почему вам стоит посетить Катманду",// ~ 99 B
  "text": "Первая причина - это ты, а вторая - все твои мечты... Лорем ипсум долор сит амет, но доцтус вереар нам, ерудити аппетере елецтрам сед цу. Сумо аппеллантур иус ад, симул ноструд но нец, цонгуе фацете ест ин. Вел аутем лаборе дефкиниебас ат, цу алии тхеопхрастус вис, ин усу вивендум волутпат. Нец дицерет реформиданс еу, ат унум суавитате иус. Ет велит волуптатум цонтентионес сед, поссит аудире омиттантур еа иус, нец ид еиус сенсерит. Не проприае волуптатибу.",                         // ~ 836 B
  "photo": [
    "https://cdn-domain.com/photos/file-name01.jpg",
    "https://cdn-domain.com/photos/file-name01.jpg",
    "https://cdn-domain.com/photos/file-name01.jpg"
  ],                                                         // ~ 155 B
  "locationName": "Ступа Боднатх",                           // ~ 44 B
  "isReacted": true,                                         // ~ 18 B
  "reactionType": "&#128525;",                               // ~ 28 B
  "reactionsCount": 156,                                     // ~ 22 B
  "commentsCount": 11,                                       // ~ 20 B
  "createdAt": "2017-07-21T17:32:28Z"                        // ~ 36 B
}                                                            // ИТОГО ~ 1356 B ~ 1,4 KB
```

|                           | Трафик в низкий сезон                                                                                                            | Трафик в высокий сезон |
| ------------------------- | -------------------------------------------------------------------------------------------------------------------------------- | ---------------------- |
| **JSON Traffic (Write)**  | 30 RPS * 1,4 KB ≈ 42 KB/Sec                                                                                                      | 84 KB/Sec              |
| **Media Traffic (Write)** | 30 RPS \* 4 MB \* 3 = 360 MB/Sec                                                                                                 | 720 MB/Sec             |
| **JSON Traffic (Read)**   | 580 RPS \* 1,4 KB + 980 RPS \* 1,4 KB \* 20 (размер батча) ≈ 28,252 MB/Sec                                                       | 56,504 MB/Sec          |
| **Media Traffic (Read)**  | 580 RPS \* 0,3 MB \* 3 (кол-во фото в посте) + 980 RPS \* 0,3 MB \* 3 (кол-во фото в посте) \* 20 (размер батча) ≈ 18 162 MB/Sec | 36 324 MB/Sec          |
#### 4.2.4. Реакции
Reaction JSON:
```JSON
{
  "reactionId"  : "123e4567-e89b-12d3-a456-426655440003",     // ~ 49 B
  "postId"      : "123e4567-e89b-12d3-a456-426655440001",     // ~ 49 B
  "userId"      : "123e4567-e89b-12d3-a456-426655440000",     // ~ 49 B
  "reactionType": "&#128525;"                                 // ~ 28 B
}                                                             // ИТОГО ~ 175 B ~ 0,2 KB
```

|                          | Трафик в низкий сезон                              | Трафик в высокий сезон |
| ------------------------ | -------------------------------------------------- | ---------------------- |
| **JSON Traffic (Write)** | 490 RPS * 0,2 KB ≈ 98 KB/Sec                       | 196 KB/Sec             |
| **JSON Traffic (Read)**  | 580 RPS * 0,2 KB \* 50 (размер батча) ≈ 5,8 MB/Sec | 11,6 MB/Sec            |
#### 4.2.5. Комментарии
Comment JSON:
```JSON
{
  "commentId": "123e4567-e89b-12d3-a456-426655440002",        // ~ 49 B
  "postId": "123e4567-e89b-12d3-a456-426655440001",           // ~ 49 B
  "userId": "123e4567-e89b-12d3-a456-426655440000",           // ~ 49 B
  "text": "Спасибо за интересный пост! Мне понравилось это место. Когда-нибудь обязательно туда съездим всей семьей!",  // ~ 204 B
  "createdAt": "2017-07-21T17:32:28Z"                         // ~ 36 B
}                                                             // ИТОГО ~ 387 B ~ 0,4 KB
```

|                          | Трафик в низкий сезон                               | Трафик в высокий сезон |
| ------------------------ | --------------------------------------------------- | ---------------------- |
| **JSON Traffic (Write)** | 250 RPS * 0,4 KB ≈ 100 KB/Sec                       | 200 KB/Sec             |
| **JSON Traffic (Read)**  | 580 RPS * 0,4 KB \* 20 (размер батча) ≈ 4,64 MB/Sec | 9,28 MB/Sec            |
#### 4.2.6. Места путешествий
Location JSON:
```JSON
{
  "locationId": "123e4567-e89b-12d3-a456-426655440000",       // ~ 49 B
  "name"      : "Ступа Боднатх",                              // ~ 36 B
  "category"  : "Храмовый комплекс",                          // ~ 48 B
  "country"   : "Непал",                                      // ~ 24 B
  "latitude"  : "27.7227",                                    // ~ 22 B
  "longitude" : "85.3641"                                     // ~ 23 B
}                                                             // ИТОГО ~ 202 B ~ 0,21 KB
```

|                         | Трафик в низкий сезон                                                    | Трафик в высокий сезон |
| ----------------------- | ------------------------------------------------------------------------ | ---------------------- |
| **JSON Traffic (Read)** | 20 RPS \* 0,21 KB + 60 RPS * 0,21 KB \* 20 (размер батча) ≈ 256,2 KB/Sec | 512,4 KB/Sec           |
## 4.3. Количество одновременных соединений

|                 | Количество одновременных соединений в низкий сезон | Количество одновременных соединений в высокий сезон |
| --------------- | -------------------------------------------------- | --------------------------------------------------- |
| **Connections** | 10 000 000 * 0,1 = 1 000 000                       | 2 000 000                                           |

## 5. Расчет ресурсов для хранения данных системы
### 5.1. Оценка дисков
Расчеты выполнены с учетом сезонности.
При этом:
- длительность низкого сезона: 365-112 = 253 дня;
- длительность высокого сезона: 112 дней.

При расчете Capacity учено количество дней низкого и высокого сезонов.    

Traffic_per_second и iops рассчитаны по высокому сезону, чтобы диски не стали узким местом в периоды высокого сезона.   

#### 5.1.1. Объектное хранилище
Объектное хранилище используется для хранения:
- фото профилей пользователей (<=1 фото на 1 профиль);
- фото постов (<=10 фото на 1 пост).

В качестве объектного хранилища будет использоваться MinIO.

- **Capacity (фото профилей пользователей):** (40 MB/Sec * 86 400 * 253) + (80 MB/Sec * 86 400 * 112) = 874 368 000 + 774 144 000 = 1 648 512 000 MB/Year = 1 648 512 000 MB/Year = 1 648,5 TB/Year = **1,6485 PB/Year**   
Для фото профилей пользователей отсутствуют "дешевые" для выявления закономерности, по которым можно определить частоту вызова фото пользователей. Поэтому оптимизация/охлаждение данных  использоваться для таких объектов не будет.
- **traffic_per_second**: 80 MB/Sec+6 552 MB/Sec = **6 632 MB/Sec** 
- **iops**: 20 RPS + 240 RPS + 240 RPS * 20 + 40 RPS * 20 + 100 RPS * 20 + 700 RPS * 20 = 20 RPS + 240 RPS + 4 800 RPS + 800 RPS + 2000 RPS + 14 000 RPS = **21 860**

**Расчет для хранения на SSD SATA 100 TB**:
- Disks_for_capacity = 1 648,5 TB / 100 = 16,5
- Disks_for_throughput =  6 632 MB/Sec / 500 MB/Sec  = 13,3
- Disks_for_iops = 21 860 / 1000 = 21,86
- **Disks = max(ceil(16,5), ceil(13,3), ceil(21,86)) = 22** 

**Capacity (фото постов)**: (360 MB/Sec * 86 400 * 253) + (720 MB/Sec * 86 400 * 112) = 7 869 312 000 + 6 967 296 000 = 14 836 608 000 MB/Year =14 836,6 TB/Year = **14,8366 PB/Year**   
Очень большой объем данных. Для хранения будет использоваться разделение данных на горячие и холодные:
- Горячими считаются данные за последний месяц.
- Горячие данные хранятся на SSD.
- Данные старше 1 месяца считаются холодными (по статистике к ним значительно реже обращаются) и переносятся для хранения на HDD.
- Соотношение запросов к горячим / холодным данным - 90/10 % соответственно.

Таким образом получаем:
- **Capacity (фото постов, горячие данные):** 14,8366 PB/Year / 12 = **1,24 PB/Year**
- **Capacity (фото постов, холодные данные):** 14,8366 PB/Year - 1,24 = **13,6 PB/Year**
- **traffic_per_second (фото постов)**: 720 MB/Sec+36 324 MB/Sec = **37 044 MB/Sec**
- **iops (фото постов)**: 40 RPS* 10 + 10 RPS * 10  + 10 RPS * 10 + 1160 RPS * 10 + 480 RPS * 20 * 10 + 1400 RPS * 20 * 10 + 80 RPS * 20 * 10  = 400 + 100 + 100 + 11 600 + 96 000 + 280 000 + 16 000 = **404 200**

**Расчет для хранения "горячих" фото потов на SSD SATA 100 TB**:
- Disks_for_capacity = 1 240 TB / 100 = 12,4
- Disks_for_throughput =  0,9 * 37 044 MB/Sec / 500 MB/Sec  = 66,7	
- Disks_for_iops = 0,9 * 404 200 / 1 000 = 363,78
- Disks = max(ceil(12,4), ceil(66,7), ceil(363,78)) = 364 

**Расчет для хранения "горячих" фото потов на SSD nVME 30 TB**:
- Disks_for_capacity = 1 240 TB / 30 = 41,3
- Disks_for_throughput =  0,9 * 37 044 MB/Sec / 3 000 MB/Sec  = 11,1
- Disks_for_iops = 0,9 * 404 200 / 10 000 = 36,378
- **Disks = max(ceil(41,3), ceil(11,1), ceil(36,378)) = 42**

При таком раскладе для хранения горячих данных более оптимальным будут диски SSD nVME.

**Расчет для хранения "холодных" фото потов на HDD 32 TB**:
- Disks_for_capacity = 13 600 TB / 32 = 425
- Disks_for_throughput =  0,1 * 37 044 MB/Sec / 100 MB/Sec  = 37,04
- Disks_for_iops = 0,1 * 404 200 / 100 = 404,2
- **Disks = max(ceil(425), ceil(37,04), ceil(404,2)) = 425** 

**Итого для S3 хранилища на 1 год работы системы требуется**:
- 22 SSD SATA 100 TB;
- 42 SSD nVME 30 TB;
- 425 HDD 32 TB.

#### 5.1.2. Пользователи
Для хранения основных данных профилей пользователей будет использоваться реляционная СУБД PostgreSQL.

- **Capacity:** (5 KB/Sec * 86 400 * 253) + (10 KB/Sec * 86 400 * 112) = 109 296 000 + 96 768 000 = 206 064 000 KB/Year = **0,2 TB/Year**
- **traffic_per_second**: 10 KB/Sec+10,92 MB/Sec = **10,93 MB/Sec** 
- **iops**: 20 RPS + 240 RPS + 240 RPS * 20 + 40 RPS * 20 + 100 RPS * 20 + 700 RPS * 20 = 20 + 240 + 4 800 + 800 + 2000 + 14 000 = **21 860**

**Расчет для хранения на SSD nVME 250 GB**:
- Disks_for_capacity = 0,2 TB / 0,25 TB = 0,8
- Disks_for_throughput =  10,93 MB/Sec / 3 000 MB/Sec  = 0,004
- Disks_for_iops = 21 860 / 10 000 = 2,186
- **Disks = max(ceil(0,8), ceil(0,004), ceil(2,186)) = 3**

**Итого для хранения данных пользователей на 1 год работы системы требуется: 3 SSD nVME 250 GB**

#### 5.1.3. Подписки
Для хранения подписок будет использоваться реляционная СУБД PostgreSQL.

- **Capacity:** (0,9 KB/Sec * 86 400 * 253) + (1,8 KB/Sec * 86 400 * 112) = 19 673 280 + 17 418 240 = 37 091 520 KB/Year = **0,04 TB/Year**
- **traffic_per_second**: 1,8 KB/Sec = **0,0018 MB/Sec** 
- **iops**: 120 RPS + 60 RPS = **180**

**Расчет для хранения на SSD SATA 250 GB**:
- Disks_for_capacity = 0,04 TB / 0,25 TB = 0,16
- Disks_for_throughput = 0,0018 MB/Sec / 500 MB/Sec  = 0,0000036
- Disks_for_iops = 180 / 1 000 = 0,18
- **Disks = max(ceil(0,16), ceil(0,0000036), ceil(0,18)) = 1**

**Итого для хранения данных подписок на 1 год работы системы требуется: 1 SSD SATA 250 GB**

#### 5.1.4. Посты
Для хранения постов будет использоваться реляционная СУБД PostgreSQL.

- **Capacity:** (42 KB/Sec * 86 400 * 253) + (84 KB/Sec * 86 400 * 112) = 918 086 400 + 812 851 200 = 1 730 937 600 KB/Year = **1,73 TB/Year**
- **traffic_per_second**: 84 KB/Sec + 56,504 MB/Sec = **56,588 MB/Sec** 
- **iops**: 40 RPS + 10 RPS + 10 RPS + 1160 RPS + 480 RPS * 20 + 1400 RPS * 20 + 80 RPS * 20 = 40 + 10 + 10 + 1160 + 9 600 + 28 000 + 1 600 = **40 420**

**Расчет для хранения на SSD nVME 2 TB**:
- Disks_for_capacity = 1,73 TB / 2 = 0,865
- Disks_for_throughput =  56,588 MB/Sec / 3 000 MB/Sec  = 0,019
- Disks_for_iops = 40 420 / 10 000 = 4,042
- **Disks = max(ceil(0,29), ceil(0,019), ceil(4,042)) = 5**

**Итого для хранения данных постов на 1 год работы системы требуется: 5 SSD nVME 2 TB**

#### 5.1.5. Реакции
Для хранения реакций будет использоваться реляционная СУБД PostgreSQL.

- **Capacity:** (98 KB/Sec * 86 400 * 253) + (196 KB/Sec * 86 400 * 112) = 2 142 201 600 + 1 896 652 800 = 4 038 854 400 KB/Year = **4,04 TB/Year**
- **traffic_per_second**: 196 KB/Sec + 11,6 MB/Sec = **11,796 MB/Sec** 
- **iops**: 940 RPS + 40 RPS + 1160 RPS * 50 = **58 980**

**Расчет для хранения на SSD nVME 2 TB**:
- Disks_for_capacity = 4,04 TB / 2 = 2,02
- Disks_for_throughput =  11,796 MB/Sec / 3 000 MB/Sec  = 0,004
- Disks_for_iops = 58 980 / 10 000 = 5,898
- **Disks = max(ceil(2,02), ceil(0,004), ceil(5,898)) = 6**

**Итого для хранения данных реакций на 1 год работы системы требуется: 6 SSD nVME 2 TB**

#### 5.1.6. Комментарии
Для хранения реакций будет использоваться реляционная СУБД PostgreSQL.

- **Capacity:** (100 KB/Sec * 86 400 * 253) + (200 KB/Sec * 86 400 * 112) = 2 185 920 000 + 1 935 360 000 = 4 121 280 000 KB/Year = **4,12 TB/Year**
- **traffic_per_second**: 200 KB/Sec + 9,28 MB/Sec = **9,48 MB/Sec** 
- **iops**: 480 RPS + 10 RPS + 10 RPS + 1160 RPS * 20 = **23 700**

**Расчет для хранения на SSD nVME 3 TB**:
- Disks_for_capacity = 4,12 TB / 3 = 1,37
- Disks_for_throughput =  9,48 MB/Sec / 3 000 MB/Sec  = 0,003
- Disks_for_iops = 23 700 / 10 000 = 2,37
- **Disks = max(ceil(1,37), ceil(0,003), ceil(2,37)) = 3**

**Итого для хранения данных комментариев на 1 год работы системы требуется: 3 SSD nVME 3 TB**

#### 5.1.7. Места путешествий
Для хранения мест путешествий будет использоваться реляционная СУБД PostgreSQL.  
В течение первого года работы социальной сети наполнение справочника места путешествий будет выполняться через сотрудников отдела сопровождения (загрузка данных в БД из файлов, содержащих реестр объектов).  
Прогнозируется, что к концу года справочник будет содержать 500 000 000 записей.

- **Capacity:** 0,21 KB * 500 000 000 = 105 000 000 KB/Year = **0,105 TB/Year**
- **traffic_per_second**: 512,4 KB/Sec = **0,5124 MB/Sec** 
- **iops**: 80 RPS * 20 + 40 RPS * 20 + 40 RPS = 1 600 + 800 + 40 = **2 440**

**Расчет для хранения на SSD SATA 250 GB**:
- Disks_for_capacity = 0,105 TB / 0,25 TB = 0,42
- Disks_for_throughput = 0,5124 MB/Sec / 500 MB/Sec  = 0,001
- Disks_for_iops = 2 440 / 1 000 = 2,44
- **Disks = max(ceil(0,42), ceil(0,001), ceil(2,44)) = 3**

**Итого для хранения данных мест путешествий на 1 год работы системы требуется: 3 SSD SATA 250 GB**

### 5.2. Оценка оперативной памяти для хранения данных
#### 5.2.1. Пользователи, additional in-memory DB  
Для хранения агрегированных и дополнительных данных по пользователям и быстрого доступа к этим данным будет использоваться вспомогательная in-memory БД.  
Будет использоваться Key-Value СУБД Redis.   

БД будет хранить:
1. Признак "онлайн" для пользователя (булево):
	1. 20 000 000 (количество пользователей в высокий сезон)  * (16 B (ключ) + 1 B (~ размер одного значения)) = 340 000 000 B = 0,34 GB
2. Количество подписок пользователя (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * (16 B (ключ) + 4 B (~ размер одного значения)) = 2 000 000 000 B = 2 GB
3. Количество подписчиков пользователя (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * (16 B (ключ) + 9 B (~ размер одного значения)) = 2 500 000 000 B = 2,5 GB
4. Список id подписчиков (множество уникальных значений)
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * (16 B (ключ) + (70 (~ среднее количество подписчиков у пользователя) * 16 B (uuid)) = 113 600 000 000 B = 113,6 GB

Получаем: 0,34 GB + 2 GB + 2,5 GB + 113,6 GB = 118,44 GB + 20% (запас) ≈ 144 GB

**Итого для хранения в оперативной памяти агрегированных и дополнительных данных по пользователям на 1 год работы системы требуется: 144 GB RAM**

#### 5.2.2. Посты, additional in-memory DB  
Для хранения агрегированных и дополнительных данных по постам, реакциям, комментариям и быстрого доступа к этим данным будет использоваться вспомогательная in-memory БД.  
Будет использоваться Key-Value СУБД Redis.

БД будет хранить:
1. Общее количество реакций на пост (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * 0,13 (количество постов, которое создает пользователь в день)  * 365 * (16 B (ключ) + 4 B (~ размер одного значения)) = 94 900 000 000 B = 94,9 GB
2. Количество реакций like на пост (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * 0,13 (количество постов, которое создает пользователь в день)  * 365 * (16 B (ключ) + 3 B (~ размер одного значения)) = 90 155 000 000 B = 90,155 GB
3. Количество реакций dislike на пост (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * 0,13 (количество постов, которое создает пользователь в день)  * 365 * (16 B (ключ) + 3 B (~ размер одного значения)) = 90 155 000 000 B = 90,155 GB
4. Количество реакций love на пост (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * 0,13 (количество постов, которое создает пользователь в день)  * 365 * (16 B (ключ) + 3 B (~ размер одного значения)) = 90 155 000 000 B = 90,155 GB
5. Количество реакций haha на пост (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * 0,13 (количество постов, которое создает пользователь в день)  * 365 * (16 B (ключ) + 3 B (~ размер одного значения)) = 90 155 000 000 B = 90,155 GB
6. Количество реакций sad на пост (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * 0,13 (количество постов, которое создает пользователь в день)  * 365 * (16 B (ключ) + 3 B (~ размер одного значения)) = 90 155 000 000 B = 90,155 GB
7. Количество комментариев к посту (целое число):
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * 0,13 (количество постов, которое создает пользователь в день)  * 365 * (16 B (ключ) + 3 B (~ размер одного значения)) = 90 155 000 000 B = 90,155 GB
8. Количество упоминаний места путешествия в постах (целое число):
	1. 500 000 000 (прогнозное количество мест путешествий через 1 год работы) * (16 B (ключ) + 9 B (~ размер одного значения)) = 12 500 000 B = 0,0125 GB

Получаем: 94,9 GB + 90,155 GB + 90,155 GB + 90,155 GB + 90,155 GB + 90,155 GB + 90,155 GB + 0,0125 GB = 635,8425 GB + 20% (запас) ≈ 768 GB

**Итого для хранения в оперативной памяти агрегированных и дополнительных данных по постам на 1 год работы системы требуется: 768 GB RAM**

#### 5.2.3. Списки пользователей
Операции со списками пользователей являются высоконагруженными. Для быстрого получения списков пользователей будет реализован процесс предварительной подготовки списков пользователей и последующее их хранение в оперативной памяти.  
Для хранения подготовленных списков пользователей будет использоваться Key-Value СУБД Redis.

БД будет хранить:
1. 200 самых запрашиваемых пользователей общего списка пользователей, при сортировке по умолчанию:
	1. 5 B (ключ) + 500 B (размер записи профиля пользователя) * 200 (количество пользователей) = 100 005 B = 0,000100005 GB
2. Список подписок пользователя - 60 пользователей (3 страницы), при сортировке по умолчанию:
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * (16 B (ключ) + 500 B (размер записи профиля пользователя) * 60 (количество пользователей)) = 3 001 600 000 000 B = 3 001,6 GB
3. Список подписчиков пользователя - 60 пользователей (3 страницы), при сортировке по умолчанию:
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * (16 B (ключ) + 500 B (размер записи профиля пользователя) * 60 (количество пользователей)) = 3 001 600 000 000 B = 3 001,6 GB

Получаем: 0,000100005 GB + 3 001,6 GB + 3 001,6 GB ≈ 6 003,2 GB + 20% (запас) ≈ 7,216 TB

**Итого для хранения в оперативной памяти предварительно подготовленных списков пользователей на 1 год работы системы требуется: 7,216 TB RAM**

#### 5.2.5. Ленты постов
Операции со списками постов являются очень высоконагруженными. Для быстрого получения лент постов будет реализован процесс предварительной подготовки лент постов и последующее их хранение в оперативной памяти.  
Для хранения подготовленных лент постов будет использоваться Key-Value СУБД Redis.

БД будет хранить:
1. Ленты постов пользователей (свои посты пользователя), 60 последних по хронологии постов:
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * (16 B (ключ) + 1400 B (размер записи поста) * 60 (количество постов)) = 8 401 600 000 000 B =8 401,6 GB
2. Ленты по подпискам пользователей, 60 последних по хронологии постов:
	1. 100 000 000 (прогнозное количество пользователей через 1 год работы) * (16 B (ключ) + 1400 B (размер записи поста) * 60 (количество постов)) = 8 401 600 000 000 B =8 401,6 GB
3. Ленты по местам путешествий, 60 последних по хронологии постов для 200 самых популярных локаций:
	1. 200 * (16 B (ключ) + 1400 B (размер записи поста) * 60 (количество постов)) = 16 803 200 B = 0,0168032 GB

Получаем: 8 401,6 GB + 8 401,6 GB + 0,0168032 GB ≈ 16 803,2 GB + 20% (запас) ≈ 20,176 TB

**Итого для хранения в оперативной памяти предварительно подготовленных списков пользователей на 1 год работы системы требуется: 20,176 TB RAM**

## 6. Оценка хостов с учетом репликации
### 6.1. Объектное хранилище для медиа
Особенности и ограничения, накладываемые выбранной технологией объектного хранилища - MinIO:
- В MinIO не различаются типы дисков и не используются смешанные типы хранилищ, поэтому на всех нодах рекомендуется использовать одинаковый тип дисков (NVMe, SSD или HDD) с одинаковой ёмкостью.

При этом в MinIO:
- при объединении разных типов дисков в одну ноду/хост, общая скорость такой ноды будет определяться самым медленным диском.
- размер используемого диска ограничивается до самого маленького диска в развёртывании. Например, если в развёртывании есть 15 дисков по 10 ТБ и 1 диск по 1 ТБ, в MinIO ёмкость каждого диска ограничится до 1 ТБ.

Учитывая предварительные расчеты дисков и вышеуказанные ограничения, для хранения фото потребуется создать 3 кластера Minio:
1. для хранения фото профилей пользователей.
2. для хранения "горячих" фото постов.
3. для хранения "холодных" фото постов.

Перенос данных из горячего хранилища в холодное (с последующим удалением файлов в горячем хранилище) будет выполняться штатными средствами MinIO - lifecycle management/tiering.

#### 6.1.1. Кластер MinIO для хранения фото профилей пользователей
По требованиям MinIO кластер должен состоять минимум из 4 нод/хостов. При этом настоятельно рекомендуется иметь четное количество нод и дисков в каждой ноде (для корректной работы erasure coding).  
Увеличение нод уменьшает нагрузку на каждый диск и увеличивает отказоустойчивость хранилища в целом.

В данном случае оптимальным по балансу нагрузки и отказоустойчивости видится кластер из 6 нод.

Таким образом на 1 год работы системы:
- Предварительный расчет необходимого количества дисков для хранения фото профилей пользователей: 22 SSD SATA 100 TB
- Hosts = 6
- Disks_per_host = ceil (22/6) = 4
- Disks = 6 * 4 = 24 (увеличиваем количество относительно первоначального расчета)
- Replication factor = 2
- **Hosts_with_replication = 6 * 2 = 12**

#### 6.1.2. Кластер MinIO для хранения "горячих" фото постов
По требованиям MinIO кластер должен состоять минимум из 4 нод/хостов. При этом настоятельно рекомендуется иметь четное количество нод и дисков в каждой ноде (для корректной работы erasure coding).  
Увеличение нод уменьшает нагрузку на каждый диск и увеличивает отказоустойчивость хранилища в целом.

Данное хранилище будет самым высоконагруженным, оптимальным будет сделать большое количество нод, например возьмем 12 нод.

Таким образом на 1 год работы системы:
- Предварительный расчет необходимого количества дисков для хранения "горячих" фото постов: 42 SSD nVME 30 TB
- Hosts = 12
- Disks_per_host = ceil (42/12) = 4
- Disks = 12 * 4 = 48 (увеличиваем количество относительно первоначального расчета)
- Replication factor = 2
- **Hosts_with_replication = 12 * 2 = 24**

#### 6.1.3. Кластер MinIO для хранения "холодных" фото постов
По требованиям MinIO кластер должен состоять минимум из 4 нод/хостов. При этом настоятельно рекомендуется иметь четное количество нод и дисков в каждой ноде (для корректной работы erasure coding).  
Увеличение нод уменьшает нагрузку на каждый диск и увеличивает отказоустойчивость хранилища в целом.

Данное хранилище будет наименее нагруженным, оптимальным будет сделать ноды с увеличенным количеством дисков, например возьмем 24 диска на каждую ноду.

Таким образом на 1 год работы системы:
- Предварительный расчет необходимого количества дисков для хранения "холодных" фото постов: 425 HDD 32 TB
- Disks_per_host = 24
- Hosts = ceil (425/24) = 18 
- Disks = 18 * 24 = 432 (увеличиваем количество относительно первоначального расчета)
- Replication factor = 2
- **Hosts_with_replication = 18 * 2 = 36**

### 6.2. Пользователи
На 1 год работы системы:
- Disks = 3 (SSD nVME 250 GB)
- Disks_per_host = 1
- Hosts = 3 / 1 = 3 
- Replication factor = 3
- **Hosts_with_replication = 3 * 3 = 9**

### 6.3. Подписки
На 1 год работы системы:
- Disks = 1  (SSD SATA 250 GB)
- Disks_per_host = 1
- Hosts = 1 / 1 = 1 
- Replication factor = 3
- **Hosts_with_replication = 1 * 3 = 3**

### 6.4. Посты
На 1 год работы системы:
- Предварительный расчет необходимого количества дисков: 5 SSD nVME 2 TB
- Disks_per_host = 2 
- Hosts = ceil (5/2) = 3 
- Disks = 3 * 2 = 6  (увеличиваем количество относительно первоначального расчета)
- Replication factor = 3
- **Hosts_with_replication = 3 * 3 = 9**

### 6.5. Реакции
На 1 год работы системы:
- Disks = 6  (SSD nVME 2 TB)
- Disks_per_host = 2
- Hosts = 6 / 2 = 3 
- Replication factor = 3
- **Hosts_with_replication = 3 * 3 = 9**

### 6.6. Комментарии
На 1 год работы системы:
- Предварительный расчет необходимого количества дисков: 3  (SSD nVME 3 TB)
- Disks_per_host = 2 
- Hosts = ceil (3/2) = 2 
- Disks = 2 * 2 = 4  (увеличиваем количество относительно первоначального расчета)
- Replication factor = 3
- **Hosts_with_replication = 2 * 3 = 6** 

### 6.7. Места путешествий
На 1 год работы системы:
- Предварительный расчет необходимого количества дисков: 3  (SSD SATA 250 GB)
- Disks_per_host = 2 
- Hosts = ceil (3/2) = 2 
- Disks = 2 * 2 = 4  (увеличиваем количество относительно первоначального расчета)
- Replication factor = 3
- **Hosts_with_replication = 2 * 3 = 6**

### 6.8. Пользователи, additional in-memory DB  
На 1 год работы системы:
- Предварительный расчет необходимого количества RAM: 144 GB
- Hosts =1 
- Replication factor = 2
- **Hosts_with_replication = 1 * 2 = 2**

### 6.9. Посты, additional in-memory DB  
На 1 год работы системы:
- Предварительный расчет необходимого количества RAM: 768 GB
- Hosts =1 
- Replication factor = 2
- **Hosts_with_replication = 1 * 2 = 2**

### 6.10. Списки пользователей
На 1 год работы системы:
- Предварительный расчет необходимого количества RAM: 7,216 TB
- RAM_per_host на Redis: ~ 0.9 TB
- Hosts =8 
- Replication factor = 2
- **Hosts_with_replication = 8 * 2 = 16**

### 6.11. Ленты постов
На 1 год работы системы:
- Предварительный расчет необходимого количества RAM: 20,176 TB
- RAM_per_host на Redis: ~ 1,0088 TB
- Hosts =20 
- Replication factor = 2
- **Hosts_with_replication = 20 * 2 = 40**

Так как объем данных для хранения в оперативной памяти довольно большой, как и количество хостов, в качестве опции на развитие для оптимизации хранения данных лент постов в будущем предусмотреть процесс маркировки пользователей, ушедших в длительный инактив. Ленты для таких пользователей в перспективе не должны храниться в оперативной памяти.

## 6. Верхнеуровневая архитектура системы
Для верхнеуровнего проектирования социальной сети использовались уровни context и container нотации [C4 model](https://c4model.com/). 
### Level 1. System context diagram
<p align="center">
  <img src="/diagrams/images/l1_context.svg">
</p>

### Level 2. Travelers Journal system container diagram
В данном разделе представлена версия диаграммы, которая была незначительно упрощена для повышения читаемости (на изображении оставлен только один BFF). 
Полная версия диаграммы доступна по ссылке: [diagrams/code/l2_containers.puml](diagrams/code/l2_containers.puml)

<p align="center">
  <img src="/diagrams/images/l2_containers.svg">
</p>

